<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿäº‘èŠ‚ç‚¹V2RayèŠ‚ç‚¹åˆ†äº« - å…è´¹è®¢é˜…æœåŠ¡</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs2@0.0.2/qrcode.min.js"></script>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš€</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .node-card {
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .node-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .copy-btn {
            transition: all 0.2s ease;
        }
        
        .copy-btn:hover {
            transform: scale(1.05);
        }
        
        .copy-btn.copied {
            background-color: #10b981 !important;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        
        .status-active {
            background-color: #10b981;
            box-shadow: 0 0 8px #10b981;
        }
        
        .status-slow {
            background-color: #f59e0b;
            box-shadow: 0 0 8px #f59e0b;
        }
        
        .status-offline {
            background-color: #ef4444;
            box-shadow: 0 0 8px #ef4444;
        }
        
        .ping-good {
            color: #10b981;
        }
        
        .ping-medium {
            color: #f59e0b;
        }
        
        .ping-poor {
            color: #ef4444;
        }
        
        .glow-text {
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #1d4ed8 100%);
        }
        
        .gradient-text {
            background: linear-gradient(90deg, #60a5fa, #3b82f6, #2563eb);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .tab-active {
            border-bottom: 3px solid #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="gradient-bg shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div class="bg-blue-500 p-2 rounded-lg">
                        <i class="fas fa-rocket text-white text-xl"></i>
                    </div>
                    <h1 class="text-2xl font-bold glow-text">V2RayèŠ‚ç‚¹åˆ†äº«</h1>
                </div>
                <div class="flex space-x-4">
                    <a href="#nodes" class="px-4 py-2 rounded-lg hover:bg-blue-700 transition">èŠ‚ç‚¹åˆ—è¡¨</a>
                    <a href="#subscribe" class="px-4 py-2 rounded-lg hover:bg-blue-700 transition">è®¢é˜…é“¾æ¥</a>
                    <a href="#tutorial" class="px-4 py-2 rounded-lg hover:bg-blue-700 transition">ä½¿ç”¨æ•™ç¨‹</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-8">
        <!-- æ ‡é¢˜å’Œæè¿° -->
        <section class="text-center mb-12 fade-in">
            <h2 class="text-4xl font-bold mb-4 gradient-text">å…è´¹V2Rayè®¢é˜…èŠ‚ç‚¹åˆ†äº«</h2>
            <p class="text-gray-300 text-lg max-w-3xl mx-auto">
                æœ¬ç½‘ç«™æä¾›å…è´¹çš„V2Rayè®¢é˜…èŠ‚ç‚¹ï¼Œæ¯æ—¥æ›´æ–°ã€‚è¯·åˆç†ä½¿ç”¨ï¼Œéµå®ˆå½“åœ°æ³•å¾‹æ³•è§„ã€‚
            </p>
            <div class="mt-6 flex justify-center space-x-4">
                <div class="bg-blue-900/50 p-3 rounded-lg">
                    <i class="fas fa-shield-alt text-blue-400 mr-2"></i>
                    <span>å®‰å…¨åŠ å¯†</span>
                </div>
                <div class="bg-blue-900/50 p-3 rounded-lg">
                    <i class="fas fa-bolt text-green-400 mr-2"></i>
                    <span>é«˜é€Ÿç¨³å®š</span>
                </div>
                <div class="bg-blue-900/50 p-3 rounded-lg">
                    <i class="fas fa-sync text-yellow-400 mr-2"></i>
                    <span>æ¯æ—¥æ›´æ–°</span>
                </div>
            </div>
        </section>

        <!-- èŠ‚ç‚¹åˆ—è¡¨ -->
        <section id="nodes" class="mb-12">
        <!--
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-server mr-3 text-blue-400"></i>
                    å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨
                </h3>
                <div class="flex space-x-2">
                    <button id="refreshBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i>
                        åˆ·æ–°èŠ‚ç‚¹
                    </button>
                    <button id="pingAllBtn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition flex items-center">
                        <i class="fas fa-signal mr-2"></i>
                        æµ‹è¯•å»¶è¿Ÿ
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="nodesContainer">
               
            </div>
            -->
        </section>

        <!-- è®¢é˜…é“¾æ¥éƒ¨åˆ† -->
        <section id="subscribe" class="mb-12 bg-gray-800 rounded-xl p-6 shadow-lg">
            <h3 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-link mr-3 text-blue-400"></i>
                è®¢é˜…é“¾æ¥åˆ—è¡¨
            </h3>

            <div id="subscribeLoading" class="text-center py-8 hidden">
                <i class="fas fa-spinner fa-spin text-4xl text-blue-400 mb-4"></i>
                <p class="text-gray-400">åŠ è½½ä¸­...</p>
            </div>

            <div id="subscribeList" class="space-y-4 mb-6">
                <!-- è®¢é˜…é“¾æ¥åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- ç¿»é¡µæ§ä»¶ -->
            <div id="pagination" class="flex justify-center items-center space-x-2 mt-6 hidden">
                <button id="firstPageBtn" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button id="prevPageBtn" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-angle-left"></i>
                </button>
                <span id="pageInfo" class="px-4 py-2 text-gray-300"></span>
                <button id="nextPageBtn" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-angle-right"></i>
                </button>
                <button id="lastPageBtn" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </section>

        <!-- ä½¿ç”¨æ•™ç¨‹ -->
        <section id="tutorial" class="mb-12">
            <h3 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-graduation-cap mr-3 text-blue-400"></i>
                ä½¿ç”¨æ•™ç¨‹
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-gray-800 p-6 rounded-xl node-card">
                    <div class="text-center mb-4">
                        <div class="bg-blue-900 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-download text-blue-400 text-xl"></i>
                        </div>
                        <h4 class="font-bold text-lg">1. ä¸‹è½½å®¢æˆ·ç«¯</h4>
                    </div>
                    <p class="text-gray-300 text-sm">
                        ä¸‹è½½å¹¶å®‰è£…V2Rayå®¢æˆ·ç«¯ï¼Œå¦‚V2RayN (Windows)ã€Clash (Mac/Android/iOS)ã€Qv2ray (Linux)ç­‰ã€‚
                    </p>
                </div>
                
                <div class="bg-gray-800 p-6 rounded-xl node-card">
                    <div class="text-center mb-4">
                        <div class="bg-blue-900 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-link text-blue-400 text-xl"></i>
                        </div>
                        <h4 class="font-bold text-lg">2. æ·»åŠ è®¢é˜…</h4>
                    </div>
                    <p class="text-gray-300 text-sm">
                        åœ¨å®¢æˆ·ç«¯ä¸­æ‰¾åˆ°è®¢é˜…è®¾ç½®ï¼Œæ·»åŠ ä¸Šæ–¹æä¾›çš„è®¢é˜…é“¾æ¥ï¼Œç„¶åæ›´æ–°è®¢é˜…è·å–èŠ‚ç‚¹åˆ—è¡¨ã€‚
                    </p>
                </div>
                
                <div class="bg-gray-800 p-6 rounded-xl node-card">
                    <div class="text-center mb-4">
                        <div class="bg-blue-900 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-play text-blue-400 text-xl"></i>
                        </div>
                        <h4 class="font-bold text-lg">3. è¿æ¥ä½¿ç”¨</h4>
                    </div>
                    <p class="text-gray-300 text-sm">
                        ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå»¶è¿Ÿè¾ƒä½çš„èŠ‚ç‚¹ï¼Œç‚¹å‡»è¿æ¥å³å¯å¼€å§‹ä½¿ç”¨ã€‚å»ºè®®å®šæœŸæ›´æ–°è®¢é˜…ã€‚
                    </p>
                </div>
            </div>
        </section>

        <!-- å…è´£å£°æ˜ -->
        <section class="bg-gray-800/50 p-6 rounded-xl border border-gray-700">
            <h4 class="font-bold text-lg mb-3 flex items-center">
                <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                å…è´£å£°æ˜
            </h4>
            <p class="text-gray-300 text-sm">
                æœ¬ç½‘ç«™æä¾›çš„V2RayèŠ‚ç‚¹ä»…ä¾›å­¦ä¹ ã€ç§‘ç ”å’Œåˆæ³•ç”¨é€”ä½¿ç”¨ã€‚ç”¨æˆ·åº”éµå®ˆæ‰€åœ¨å›½å®¶æˆ–åœ°åŒºçš„æ³•å¾‹æ³•è§„ï¼Œä¸å¾—ç”¨äºä»»ä½•éæ³•æ´»åŠ¨ã€‚èŠ‚ç‚¹ç”±ç¤¾åŒºç»´æŠ¤ï¼Œä¸ä¿è¯é•¿æœŸç¨³å®šå¯ç”¨ã€‚ä½¿ç”¨æœ¬æœåŠ¡å³è¡¨ç¤ºæ‚¨åŒæ„æ‰¿æ‹…æ‰€æœ‰ä½¿ç”¨é£é™©ã€‚
            </p>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="gradient-bg mt-12 py-6">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center space-x-2">
                        <div class="bg-blue-500 p-2 rounded-lg">
                            <i class="fas fa-rocket text-white"></i>
                        </div>
                        <span class="text-lg font-bold">V2RayèŠ‚ç‚¹åˆ†äº«</span>
                    </div>
                    <p class="text-gray-300 text-sm mt-2">å…è´¹ã€å®‰å…¨ã€é«˜é€Ÿçš„V2Rayè®¢é˜…æœåŠ¡</p>
                </div>
                
                <div class="text-center md:text-right">
                    <p class="text-gray-300 text-sm">Â© 2023 V2RayèŠ‚ç‚¹åˆ†äº«ç¤¾åŒº</p>
                    <p class="text-gray-400 text-xs mt-1">æœ€åæ›´æ–°: <span id="lastUpdate">ä»Šå¤©</span></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- é€šçŸ¥æç¤º -->
    <div id="notification" class="fixed bottom-4 right-4 bg-green-600 text-white p-4 rounded-lg shadow-xl transform translate-y-16 transition-transform duration-300 z-50 hidden">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-3"></i>
            <span id="notificationText">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</span>
        </div>
    </div>

    <!-- äºŒç»´ç å¼¹çª— -->
    <div id="qrModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-gray-800 rounded-2xl p-6 max-w-sm w-full mx-4 shadow-2xl transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-100">è®¢é˜…äºŒç»´ç </h3>
                <button id="closeQrModal" class="text-gray-400 hover:text-white transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="bg-white p-4 rounded-lg mb-4">
                <div id="qrcode" class="flex justify-center"></div>
            </div>
            <p id="qrUrlText" class="text-gray-400 text-sm mb-4 break-all text-center"></p>
            <div class="flex gap-3">
                <button id="copyQrUrl" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition flex items-center justify-center">
                    <i class="fas fa-copy mr-2"></i>
                    å¤åˆ¶é“¾æ¥
                </button>
                <button id="openQrUrl" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 rounded-lg transition flex items-center justify-center">
                    <i class="fas fa-external-link-alt mr-2"></i>
                    æ‰“å¼€é“¾æ¥
                </button>
            </div>
        </div>
    </div>

    <script>
        // èŠ‚ç‚¹æ•°æ®
        const nodes = [
            {
                id: 1,
                name: "ç¾å›½èŠ‚ç‚¹-01",
                country: "us",
                location: "ç¾å›½ Â· æ´›æ‰çŸ¶",
                server: "us01.v2ray.example.com",
                port: "443",
                protocol: "VMess",
                status: "active",
                ping: 0,
                speed: "é«˜é€Ÿ",
                uptime: "99.8%",
                load: "ä½"
            },
            {
                id: 2,
                name: "æ—¥æœ¬èŠ‚ç‚¹-01",
                country: "jp",
                location: "æ—¥æœ¬ Â· ä¸œäº¬",
                server: "jp01.v2ray.example.com",
                port: "443",
                protocol: "VMess",
                status: "active",
                ping: 0,
                speed: "æé€Ÿ",
                uptime: "99.9%",
                load: "ä¸­"
            },
            {
                id: 3,
                name: "æ–°åŠ å¡èŠ‚ç‚¹-01",
                country: "sg",
                location: "æ–°åŠ å¡",
                server: "sg01.v2ray.example.com",
                port: "443",
                protocol: "VMess",
                status: "active",
                ping: 0,
                speed: "é«˜é€Ÿ",
                uptime: "99.7%",
                load: "ä½"
            },
            {
                id: 4,
                name: "å¾·å›½èŠ‚ç‚¹-01",
                country: "de",
                location: "å¾·å›½ Â· æ³•å…°å…‹ç¦",
                server: "de01.v2ray.example.com",
                port: "443",
                protocol: "VLESS",
                status: "slow",
                ping: 0,
                speed: "ä¸­é€Ÿ",
                uptime: "99.5%",
                load: "é«˜"
            },
            {
                id: 5,
                name: "é¦™æ¸¯èŠ‚ç‚¹-01",
                country: "hk",
                location: "ä¸­å›½ Â· é¦™æ¸¯",
                server: "hk01.v2ray.example.com",
                port: "443",
                protocol: "VMess",
                status: "active",
                ping: 0,
                speed: "æé€Ÿ",
                uptime: "99.9%",
                load: "ä¸­"
            },
            {
                id: 6,
                name: "éŸ©å›½èŠ‚ç‚¹-01",
                country: "kr",
                location: "éŸ©å›½ Â· é¦–å°”",
                server: "kr01.v2ray.example.com",
                port: "443",
                protocol: "VMess",
                status: "active",
                ping: 0,
                speed: "é«˜é€Ÿ",
                uptime: "99.6%",
                load: "ä½"
            }
        ];

        // å›½å®¶æ ‡å¿—æ˜ å°„
        const countryFlags = {
            us: "ğŸ‡ºğŸ‡¸",
            jp: "ğŸ‡¯ğŸ‡µ",
            sg: "ğŸ‡¸ğŸ‡¬",
            de: "ğŸ‡©ğŸ‡ª",
            hk: "ğŸ‡­ğŸ‡°",
            kr: "ğŸ‡°ğŸ‡·"
        };

        // è®¢é˜…åˆ—è¡¨æ•°æ®
        let subscribeList = [];
        let currentPage = 1;
        let pageSize = 3;
        let totalPages = 1;

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            //renderNodes();
            //setupEventListeners();
            loadSubscribeList();
            setupPaginationListeners();

            // æ¨¡æ‹Ÿåˆå§‹pingæµ‹è¯•
            setTimeout(() => {
                simulatePingTest();
            }, 1000);
        });

        // æ¸²æŸ“èŠ‚ç‚¹å¡ç‰‡
        function renderNodes() {
            const container = document.getElementById('nodesContainer');
            container.innerHTML = '';
            
            nodes.forEach(node => {
                const statusClass = node.status === 'active' ? 'status-active' : 
                                  node.status === 'slow' ? 'status-slow' : 'status-offline';
                
                const statusText = node.status === 'active' ? 'åœ¨çº¿' : 
                                 node.status === 'slow' ? 'ç¼“æ…¢' : 'ç¦»çº¿';
                
                const pingClass = getPingClass(node.ping);
                const pingText = node.ping > 0 ? `${node.ping}ms` : 'æµ‹è¯•ä¸­...';
                
                const card = document.createElement('div');
                card.className = 'node-card bg-gray-800 rounded-xl p-5 fade-in';
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <div class="flex items-center mb-1">
                                <span class="text-2xl mr-2">${countryFlags[node.country] || 'ğŸŒ'}</span>
                                <h4 class="font-bold text-lg">${node.name}</h4>
                            </div>
                            <p class="text-gray-400 text-sm">${node.location}</p>
                        </div>
                        <div class="flex items-center">
                            <span class="status-dot ${statusClass}"></span>
                            <span class="text-sm">${statusText}</span>
                        </div>
                    </div>
                    
                    <div class="space-y-3 mb-5">
                        <div class="flex justify-between">
                            <span class="text-gray-400">æœåŠ¡å™¨:</span>
                            <span class="font-mono text-sm">${node.server}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">ç«¯å£:</span>
                            <span class="font-mono">${node.port}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">åè®®:</span>
                            <span class="font-mono">${node.protocol}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">å»¶è¿Ÿ:</span>
                            <span class="font-mono ${pingClass}">${pingText}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">é€Ÿåº¦:</span>
                            <span class="font-mono">${node.speed}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">åœ¨çº¿ç‡:</span>
                            <span class="font-mono">${node.uptime}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">è´Ÿè½½:</span>
                            <span class="font-mono">${node.load}</span>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button class="copy-node-btn flex-1 bg-blue-600 hover:bg-blue-700 py-2 rounded-lg transition flex items-center justify-center" data-server="${node.server}" data-port="${node.port}">
                            <i class="fas fa-copy mr-2"></i>
                            å¤åˆ¶é…ç½®
                        </button>
                        <button class="ping-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition" data-id="${node.id}">
                            <i class="fas fa-signal"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // æ ¹æ®pingå€¼è·å–CSSç±»
        function getPingClass(ping) {
            if (ping === 0) return 'ping-poor';
            if (ping < 100) return 'ping-good';
            if (ping < 300) return 'ping-medium';
            return 'ping-poor';
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // åˆ·æ–°èŠ‚ç‚¹æŒ‰é’®
            document.getElementById('refreshBtn').addEventListener('click', function() {
                const btn = this;
                const originalHTML = btn.innerHTML;

                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>åˆ·æ–°ä¸­...';
                btn.disabled = true;

                // æ¨¡æ‹Ÿåˆ·æ–°è¿‡ç¨‹
                setTimeout(() => {
                    // éšæœºæ›´æ–°ä¸€äº›èŠ‚ç‚¹çš„çŠ¶æ€
                    nodes.forEach(node => {
                        if (Math.random() > 0.7) {
                            node.status = Math.random() > 0.1 ? 'active' : 'slow';
                            node.ping = 0;
                        }
                    });

                    //renderNodes();
                    setupNodeButtonListeners();

                    btn.innerHTML = originalHTML;
                    btn.disabled = false;

                    showNotification('èŠ‚ç‚¹åˆ—è¡¨å·²åˆ·æ–°');
                }, 1500);
            });

            // æµ‹è¯•æ‰€æœ‰èŠ‚ç‚¹å»¶è¿Ÿ
            document.getElementById('pingAllBtn').addEventListener('click', function() {
                const btn = this;
                const originalHTML = btn.innerHTML;

                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>æµ‹è¯•ä¸­...';
                btn.disabled = true;

                simulatePingTest(() => {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                    showNotification('å»¶è¿Ÿæµ‹è¯•å®Œæˆ');
                });
            });

            // ç¿»é¡µæŒ‰é’®äº‹ä»¶
            document.getElementById('firstPageBtn').addEventListener('click', () => goToPage(1));
            document.getElementById('prevPageBtn').addEventListener('click', () => goToPage(currentPage - 1));
            document.getElementById('nextPageBtn').addEventListener('click', () => goToPage(currentPage + 1));
            document.getElementById('lastPageBtn').addEventListener('click', () => goToPage(totalPages));

            // è®¾ç½®èŠ‚ç‚¹æŒ‰é’®ç›‘å¬å™¨
            setupNodeButtonListeners();
        }

        // è®¾ç½®èŠ‚ç‚¹æŒ‰é’®ç›‘å¬å™¨
        function setupNodeButtonListeners() {
            // å¤åˆ¶èŠ‚ç‚¹é…ç½®æŒ‰é’®
            document.querySelectorAll('.copy-node-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const server = this.getAttribute('data-server');
                    const port = this.getAttribute('data-port');
                    
                    // åˆ›å»ºé…ç½®æ–‡æœ¬
                    const config = `æœåŠ¡å™¨: ${server}\nç«¯å£: ${port}\nåè®®: VMess\nä¼ è¾“: WebSocket (TLS)\nè·¯å¾„: /v2ray\n`;
                    
                    // å¤åˆ¶åˆ°å‰ªè´´æ¿
                    navigator.clipboard.writeText(config).then(() => {
                        showNotification('èŠ‚ç‚¹é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                        
                        // æ·»åŠ å¤åˆ¶æˆåŠŸæ•ˆæœ
                        this.classList.add('copied');
                        this.innerHTML = '<i class="fas fa-check mr-2"></i>å·²å¤åˆ¶';
                        
                        setTimeout(() => {
                            this.classList.remove('copied');
                            this.innerHTML = '<i class="fas fa-copy mr-2"></i>å¤åˆ¶é…ç½®';
                        }, 2000);
                    });
                });
            });
            
            // å•ä¸ªèŠ‚ç‚¹pingæµ‹è¯•æŒ‰é’®
            document.querySelectorAll('.ping-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const nodeId = parseInt(this.getAttribute('data-id'));
                    const node = nodes.find(n => n.id === nodeId);
                    
                    if (node) {
                        const originalHTML = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        
                        // æ¨¡æ‹Ÿpingæµ‹è¯•
                        setTimeout(() => {
                            // ç”Ÿæˆéšæœºpingå€¼ï¼ˆåŸºäºèŠ‚ç‚¹çŠ¶æ€ï¼‰
                            let ping;
                            if (node.status === 'active') {
                                ping = Math.floor(Math.random() * 150) + 30;
                            } else if (node.status === 'slow') {
                                ping = Math.floor(Math.random() * 400) + 200;
                            } else {
                                ping = 999;
                            }
                            
                            node.ping = ping;
                           //renderNodes();
                            setupNodeButtonListeners();
                            
                            showNotification(`å·²æµ‹è¯• ${node.name} å»¶è¿Ÿ: ${ping}ms`);
                        }, 800);
                    }
                });
            });
        }

        // æ¨¡æ‹Ÿpingæµ‹è¯•
        function simulatePingTest(callback) {
            nodes.forEach((node, index) => {
                setTimeout(() => {
                    // ç”Ÿæˆéšæœºpingå€¼ï¼ˆåŸºäºèŠ‚ç‚¹çŠ¶æ€ï¼‰
                    let ping;
                    if (node.status === 'active') {
                        ping = Math.floor(Math.random() * 150) + 30;
                    } else if (node.status === 'slow') {
                        ping = Math.floor(Math.random() * 400) + 200;
                    } else {
                        ping = 999;
                    }
                    
                    node.ping = ping;
                    
                    // æ¯æµ‹è¯•å®Œä¸€ä¸ªèŠ‚ç‚¹å°±é‡æ–°æ¸²æŸ“
                    if (index === nodes.length - 1) {
                        //renderNodes();
                        setupNodeButtonListeners();
                        if (callback) callback();
                    }
                }, index * 300);
            });
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(inputId, button) {
            const input = document.getElementById(inputId);
            input.select();
            input.setSelectionRange(0, 99999); // å¯¹äºç§»åŠ¨è®¾å¤‡
            
            navigator.clipboard.writeText(input.value).then(() => {
                showNotification('è®¢é˜…é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                
                // æ·»åŠ å¤åˆ¶æˆåŠŸæ•ˆæœ
                button.classList.add('copied');
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i>';
                
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = originalHTML;
                }, 2000);
            });
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(text) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = text;
            notification.classList.remove('hidden');
            notification.style.transform = 'translateY(0)';
            
            setTimeout(() => {
                notification.style.transform = 'translateY(16rem)';
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 300);
            }, 3000);
        }

        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        function updateLastUpdateTime(updateTimeStr) {
            const lastUpdateEl = document.getElementById('lastUpdate');

            if (!updateTimeStr) {
                lastUpdateEl.textContent = 'æœªçŸ¥';
                return;
            }

            // è§£ææ›´æ–°æ—¶é—´å­—ç¬¦ä¸² "2026-01-22 18:17:16"
            const dateMatch = updateTimeStr.match(/(\d{4})-(\d{2})-(\d{2})\s*(\d{2}):(\d{2})(?::(\d{2}))?/);

            if (dateMatch) {
                const year = parseInt(dateMatch[1]);
                const month = parseInt(dateMatch[2]);
                const day = parseInt(dateMatch[3]);
                const hour = parseInt(dateMatch[4]);
                const minute = parseInt(dateMatch[5]);

                // æ ¼å¼åŒ–ä¸º "2026å¹´1æœˆ22æ—¥ 18:17"
                const formattedTime = `${year}å¹´${month}æœˆ${day}æ—¥ ${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                lastUpdateEl.textContent = formattedTime;
            } else {
                lastUpdateEl.textContent = updateTimeStr;
            }
        }

        // å¹³æ»‘æ»šåŠ¨åˆ°é”šç‚¹
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();

                const targetId = this.getAttribute('href');
                if (targetId === '#') return;

                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // åŠ è½½è®¢é˜…åˆ—è¡¨
        async function loadSubscribeList() {
            const loadingEl = document.getElementById('subscribeLoading');
            const listEl = document.getElementById('subscribeList');
            const paginationEl = document.getElementById('pagination');

            loadingEl.classList.remove('hidden');
            listEl.innerHTML = '';
            paginationEl.classList.add('hidden');

            try {
                const response = await fetch('/nodes/list.json');
                const data = await response.json();

                subscribeList = data.rows || [];
                pageSize = data.pageSize || 10;
                currentPage = 1;
                totalPages = Math.ceil(subscribeList.length / pageSize);

                // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
                if (data.updateTime) {
                    updateLastUpdateTime(data.updateTime);
                }

                renderSubscribeList();
                updatePagination();

                loadingEl.classList.add('hidden');
            } catch (error) {
                console.error('åŠ è½½è®¢é˜…åˆ—è¡¨å¤±è´¥:', error);
                loadingEl.innerHTML = `
                    <i class="fas fa-exclamation-circle text-4xl text-red-400 mb-4"></i>
                    <p class="text-gray-400">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</p>
                `;
            }
        }

        // æ¸²æŸ“è®¢é˜…åˆ—è¡¨
        function renderSubscribeList() {
            const listEl = document.getElementById('subscribeList');
            listEl.innerHTML = '';

            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageData = subscribeList.slice(startIndex, endIndex);

            if (pageData.length === 0) {
                listEl.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p>æš‚æ— è®¢é˜…é“¾æ¥</p>
                    </div>
                `;
                return;
            }

            pageData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-gray-900 rounded-lg p-4 border border-gray-700 hover:border-blue-500 transition';
                card.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="bg-blue-900 text-blue-300 text-xs px-2 py-1 rounded">${item.publish_date}</span>
                                <span class="bg-green-900 text-green-300 text-xs px-2 py-1 rounded">${item.node_count} æ¡èŠ‚ç‚¹</span>
                            </div>
                            <h4 class="font-semibold text-lg mb-1">${item.nodesTitle}</h4>
                        </div>
                        <div class="flex gap-2">
                            <button class="copy-url-btn bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition flex items-center"
                                    data-url="${item.v2rayUrl}"
                                    data-title="${item.nodesTitle}">
                                <i class="fas fa-copy mr-2"></i>
                                å¤åˆ¶é“¾æ¥
                            </button>
                            <button class="view-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition flex items-center"
                                    data-url="${item.v2rayUrl}"
                                    data-title="${item.nodesTitle}">
                                <i class="fas fa-eye mr-2"></i>
                                æŸ¥çœ‹å†…å®¹
                            </button>
                            <button class="qr-btn bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition flex items-center"
                                    data-url="${item.v2rayUrl}"
                                    data-title="${item.nodesTitle}">
                                <i class="fas fa-qrcode mr-2"></i>
                                äºŒç»´ç 
                            </button>
                        </div>
                    </div>
                `;
                listEl.appendChild(card);
            });

            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.copy-url-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const url = window.location.origin + this.getAttribute('data-url');
                    copyToClipboardUrl(url, this);
                });
            });

            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const url = this.getAttribute('data-url');
                    window.open(url, '_blank');
                });
            });

            // äºŒç»´ç æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.qr-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const url = window.location.origin + this.getAttribute('data-url');
                    showQRCode(url);
                });
            });
        }

        // è®¾ç½®ç¿»é¡µæŒ‰é’®ç›‘å¬å™¨
        function setupPaginationListeners() {
            const firstPageBtn = document.getElementById('firstPageBtn');
            const prevPageBtn = document.getElementById('prevPageBtn');
            const nextPageBtn = document.getElementById('nextPageBtn');
            const lastPageBtn = document.getElementById('lastPageBtn');

            if (firstPageBtn) {
                firstPageBtn.addEventListener('click', () => goToPage(1));
            }
            if (prevPageBtn) {
                prevPageBtn.addEventListener('click', () => goToPage(currentPage - 1));
            }
            if (nextPageBtn) {
                nextPageBtn.addEventListener('click', () => goToPage(currentPage + 1));
            }
            if (lastPageBtn) {
                lastPageBtn.addEventListener('click', () => goToPage(totalPages));
            }
        }

        // æ›´æ–°åˆ†é¡µæ§ä»¶
        function updatePagination() {
            const paginationEl = document.getElementById('pagination');
            const pageInfo = document.getElementById('pageInfo');

            if (subscribeList.length <= pageSize) {
                paginationEl.classList.add('hidden');
                return;
            }

            paginationEl.classList.remove('hidden');
            pageInfo.textContent = `${currentPage} / ${totalPages}`;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('firstPageBtn').disabled = currentPage === 1;
            document.getElementById('prevPageBtn').disabled = currentPage === 1;
            document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
            document.getElementById('lastPageBtn').disabled = currentPage === totalPages;
        }

        // è·³è½¬åˆ°æŒ‡å®šé¡µé¢
        function goToPage(page) {
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderSubscribeList();
            updatePagination();

            // æ»šåŠ¨åˆ°è®¢é˜…åˆ—è¡¨é¡¶éƒ¨
            const subscribeSection = document.getElementById('subscribe');
            if (subscribeSection) {
                window.scrollTo({
                    top: subscribeSection.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        }

        // å¤åˆ¶è®¢é˜…é“¾æ¥åˆ°å‰ªè´´æ¿
        function copyToClipboardUrl(url, button) {
            navigator.clipboard.writeText(url).then(() => {
                showNotification('è®¢é˜…é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');

                // æ·»åŠ å¤åˆ¶æˆåŠŸæ•ˆæœ
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-2"></i>å·²å¤åˆ¶';
                button.classList.add('bg-green-600');

                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('bg-green-600');
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }

        // æ˜¾ç¤ºäºŒç»´ç 
        let currentQrUrl = '';

        function showQRCode(url) {
            const modal = document.getElementById('qrModal');
            const qrcodeContainer = document.getElementById('qrcode');
            const urlText = document.getElementById('qrUrlText');

            currentQrUrl = url;

            // æ¸…ç©ºä¹‹å‰çš„äºŒç»´ç 
            qrcodeContainer.innerHTML = '';

            // ç”Ÿæˆæ–°çš„äºŒç»´ç 
            new QRCode(qrcodeContainer, {
                text: url,
                width: 200,
                height: 200,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });

            // è®¾ç½®URLæ–‡æœ¬
            urlText.textContent = url;

            // æ˜¾ç¤ºå¼¹çª—
            modal.classList.remove('hidden');
        }

        // å…³é—­äºŒç»´ç å¼¹çª—
        document.addEventListener('DOMContentLoaded', function() {
            // å…³é—­æŒ‰é’®
            document.getElementById('closeQrModal').addEventListener('click', function() {
                document.getElementById('qrModal').classList.add('hidden');
            });

            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            document.getElementById('qrModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });

            // ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.getElementById('qrModal').classList.add('hidden');
                }
            });

            // å¤åˆ¶äºŒç»´ç ä¸­çš„é“¾æ¥
            document.getElementById('copyQrUrl').addEventListener('click', function() {
                navigator.clipboard.writeText(currentQrUrl).then(() => {
                    showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                });
            });

            // æ‰“å¼€é“¾æ¥
            document.getElementById('openQrUrl').addEventListener('click', function() {
                window.open(currentQrUrl, '_blank');
            });
        });
    </script>
</body>
</html>